

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      utils/src/utils.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Democracy
    </h3>

    

    <h3>Classes</h3><ul><li id="BuildsManager-nav"><a href="bm.BuildsManager.html">BuildsManager</a></li><li id="ContractsManager-nav"><a href="cm.ContractsManager.html">ContractsManager</a><ul class='methods'><li data-type="method" id="ContractsManager-getContract-nav"><a href="cm.ContractsManager.html#getContract">getContract</a></li></ul></li><li id="Contract-nav"><a href="contract.Contract.html">Contract</a></li><li id="Compiler-nav"><a href="module-compile.Compiler.html">Compiler</a></li></ul><h3>Modules</h3><ul><li id="compile-nav"><a href="module-compile.html">compile</a><ul class='methods'><li data-type="method" id="compile-compile-nav"><a href="module-compile.html#.compile">compile</a></li><li data-type="method" id="compile-updateFlatten-nav"><a href="module-compile.html#.updateFlatten">updateFlatten</a></li></ul></li><li id="contract-nav"><a href="module-contract.html">contract</a><ul class='methods'><li data-type="method" id="contract-createContract-nav"><a href="module-contract.html#.createContract">createContract</a></li><li data-type="method" id="contract-getInstance-nav"><a href="module-contract.html#.getInstance">getInstance</a></li><li data-type="method" id="contract-init-nav"><a href="module-contract.html#.init">init</a></li></ul></li><li id="utils-nav"><a href="module-utils.html">utils</a><ul class='methods'><li data-type="method" id="utils-getConfig-nav"><a href="module-utils.html#.getConfig">getConfig</a></li><li data-type="method" id="utils-parseLogLevels-nav"><a href="module-utils.html#.parseLogLevels">parseLogLevels</a></li><li data-type="method" id="utils-textsEqual-nav"><a href="module-utils.html#.textsEqual">textsEqual</a></li></ul></li><li id="wallet-nav"><a href="module-wallet.html">wallet</a><ul class='methods'><li data-type="method" id="wallet-createEncryptedAccount-nav"><a href="module-wallet.html#.createEncryptedAccount">createEncryptedAccount</a></li><li data-type="method" id="wallet-createSignerEth-nav"><a href="module-wallet.html#.createSignerEth">createSignerEth</a></li><li data-type="method" id="wallet-init-nav"><a href="module-wallet.html#.init">init</a></li><li data-type="method" id="wallet-loadEncryptedAccount-nav"><a href="module-wallet.html#.loadEncryptedAccount">loadEncryptedAccount</a></li><li data-type="method" id="wallet-pay-nav"><a href="module-wallet.html#.pay">pay</a></li><li data-type="method" id="wallet-payTest-nav"><a href="module-wallet.html#.payTest">payTest</a></li><li data-type="method" id="wallet-prepareSignerEth-nav"><a href="module-wallet.html#.prepareSignerEth">prepareSignerEth</a></li><li data-type="method" id="wallet-saveEncryptedAccount-nav"><a href="module-wallet.html#.saveEncryptedAccount">saveEncryptedAccount</a></li><li data-type="method" id="wallet-unlockEncryptedAccount-nav"><a href="module-wallet.html#.unlockEncryptedAccount">unlockEncryptedAccount</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#getFileKeySpace">getFileKeySpace</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#utils">utils</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        utils/src/utils.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>'use strict'
const fs = require('fs')
const path = require('path')

const { Logger } = require('./logger')
const LOGGER = new Logger('utils/utils')
const { Seq, Map, List } = require('immutable')
const utils = {}

utils.DB_DIR       = 'db'
utils.OUTS_DIR     = 'compileOutputs'
utils.FLATS_DIR    = 'sourcesFlattened'
utils.SOURCES_DIR  = 'contracts'
utils.COMPILES_DIR = 'compiles'
utils.LINKS_DIR    = 'links'
utils.DEPLOYS_DIR  = 'deploys'
utils.LIB_PATTERN  = /__(([a-zA-Z0-9])+\/*)+\.sol:[a-zA-Z0-9]+_+/g

utils.DEMO_SRC_PATH = 'contracts'

utils.getEndpointURL = () => {
  const { getConfig } = require('./config.js')
  const config = getConfig()
  return config['ETH_URL']
}

utils.getNetwork = () => {
  const Eth = require('ethjs')
  return new Eth(new Eth.HttpProvider(utils.getEndpointURL()))
}

/**
 * Deep version of fromJS https://stackoverflow.com/a/40663730
 */
utils.fromJS = (js) => {
  return typeof js !== 'object' || js === null ? js :
    Array.isArray(js) ? 
      Seq(js).map(utils.fromJS).toList() :
      Seq(js).map(utils.fromJS).toMap()
}

utils.toJS = (imm) => {
  return (List.isList(imm)) ? imm.map((val) => {return utils.toJS(val)}).toJS() :
    (Map.isMap(imm)) ? imm.map((val) => {return utils.toJS(val)}).toJS() :
      imm
}

utils.equal = (a,b) => {
  if (Map.isMap(a) &amp;&amp; Map.isMap(b)) { return utils.immEqual(a,b) }
  if (List.isList(a) &amp;&amp; List.isList(b)) { return utils.immEqual(a,b) }
  return utils.deepEqual(a,b)
}

/**
 * Determines if two newline delimited texts are equal by line.
 *
 * @method textsEqual
 * @memberof module:utils
 * @param a {String} first text to compare
 * @param b {String} first text to compare
 * @return first line number where the two texts differ, or -1 if they are identical
 */
utils.textsEqual = (a,b) => {
  const aLines = a.split('\n')
  const bLines = b.split('\n')
  for (let i = 0; i &lt; aLines.length; i += 1) {
    if ( aLines[i] !== bLines[i] ) { return i }
  }
  return -1
}

utils.stringsEqual = (a,b) => {
  for (let i = 0; i &lt; a.length; i += 1) {
    if (a[i] !== b[i]) { return i }
  }
  return -1
}

/*
 * Deep JS object equality testing from https://stackoverflow.com/a/10316616
 */
utils.deepEqual = (a,b) => {
  if (a instanceof Array &amp;&amp; b instanceof Array)
    return utils.arraysEqual(a,b)
  if (Object.getPrototypeOf(a)===Object.prototype &amp;&amp;
      Object.getPrototypeOf(b)===Object.prototype) {
	  return utils.objectsEqual(a,b)
  }
  if (a instanceof Map &amp;&amp; b instanceof Map) {
    return utils.mapsEqual(a,b)
  }
  if (a instanceof Set &amp;&amp; b instanceof Set) {
    throw new Error('equality by hashing not implemented.')
  }
  if ((a instanceof ArrayBuffer || ArrayBuffer.isView(a)) &amp;&amp;
      (b instanceof ArrayBuffer || ArrayBuffer.isView(b))) {
	  return utils.typedArraysEqual(a,b)
  }
  return a==b  // see note[1] -- IMPORTANT
}

utils.arraysEqual = (a,b) => {
  if (a.length!=b.length) { return false }
  for (let i=0; i &lt; a.length; i++) {
    if (!utils.deepEqual(a[i],b[i]))
      return false
    return true
  }
}

utils.objectsEqual = (a,b) => {
  const aKeys = Object.getOwnPropertyNames(a)
  const bKeys = Object.getOwnPropertyNames(b)
  if (aKeys.length != bKeys.length) { return false }
  aKeys.sort()
  bKeys.sort()
  for (let i=0; i &lt; aKeys.length; i++) {
    if (aKeys[i]!=bKeys[i]) { // keys must be strings
      return false
    }
    return utils.deepEqual(aKeys.map(k=>a[k]), aKeys.map(k=>b[k]))
  }
}

utils.mapsEqual = (a,b) => {
  if (a.size != b.size) { return false }
  const aPairs = Array.from(a)
  const bPairs = Array.from(b)
  aPairs.sort((x,y) => x[0]&lt;y[0])
  bPairs.sort((x,y) => x[0]&lt;y[0])
  for (let i=0; i&lt;a.length; i++) {
    if (!utils.deepEqual(aPairs[i][0],bPairs[i][0]) ||
        !utils.deepEqual(aPairs[i][1],bPairs[i][1])) {
      return false
    }
    return true
  }
}

utils.typedArraysEqual = (_a, _b) => {
  const a = new Uint8Array(_a)
  const b = new Uint8Array(_b)
  if (a.length != b.length) { return false }
  for (let i=0; i &lt; a.length; i++) {
    if (a[i]!=b[i]) { return false }
    return true
  }
}

/**
 * @param _a {Immutable} first list or map to compare.
 * @param _b {Immutable} second list or map to compare.
 * @return true if the two objects have equal value (JSON strings) false otherwise.
 */
utils.immEqual = (_a, _b) => {
  return JSON.stringify(_a.toJS()) === JSON.stringify(_b.toJS())
}

/**
 * @return true if we are in a browser (tests for present of `window` and `window.document`
 */
utils.isBrowser = () => {
  return (typeof window != 'undefined' &amp;&amp; window.document)
}

utils.ensureDir = (dirName) => {
  if (!fs.existsSync(dirName)) { fs.mkdirSync(dirName, { recursive: true } ) }
}

/**
 * Remove a file (not a directory) if it exists
 */
utils.rimRafFileSync = (fn) => {
  if (fs.existsSync(fn)) { fs.unlinkSync(fn) }
}

/**
 * Traverse directories collecting files to perform a callback function on
 * @param startDirs a list of paths to start searching in
 * @param skipFilt a function that returns true for files that need to be skipped
 * @param cb a callback that accepts the source text of a file plus its full path
 * @param dcb a callback for every directory that is encountered
 */
utils.traverseDirs = (startDirs, skipFilt, cb, dcb) => {
  const queue = startDirs
  while (queue.length > 0) {
    const f = queue.pop()
    const shortList = path.basename(f).split('.')
    if (skipFilt(shortList, f)) { continue }
    if (!fs.existsSync(f)) {
      LOGGER.debug(`Skipping traversal directory ${f} which does not exist.`)
      continue
    }
    if (fs.lstatSync(f).isDirectory()) {
      fs.readdirSync(f).forEach((f2) => queue.push(path.join(f,f2)))
      if (dcb) { dcb(f) }
    } else {
      const source = fs.readFileSync(f).toString()
      cb(source, f)
    }
  }
}

/**
 * Traverse directories recursively building an Immutable Map with hierarchical keys
 * as directory paths and values as file contents (leaf nodes)
 * @param f the full path to a filename (possibly a directory) to start traversal
 * @param skipFilt a function that returns true for files that need to be skipped
 */
utils.buildFromDirs = (f, skipFilt) => {
  const shortList = path.basename(f).split('.')
  if (skipFilt(shortList)) { return null }
  if (fs.lstatSync(f).isDirectory()) {
    return new Map(List(fs.readdirSync(f)).map((f2) => {
      const builtValues = utils.buildFromDirs(path.join(f,f2), skipFilt)
      const baseKey = path.basename(f2)
      const key = (baseKey.endsWith('.json')) ? baseKey.split('.')[0] : baseKey
      return builtValues ? [key, builtValues] : null
    }))
  } else {
    return utils.fromJS(JSON.parse(fs.readFileSync(f)))
  }
}

/**
 * @return true if the given object is an ethjs object, otherwise false
 */
utils.isNetwork = (_network) => {
  return (_network &amp;&amp; _network.net_version)
}

utils.thenPrint = (promise) => {
  promise.then((value) => {console.log(JSON.stringify(value))})
}

/**
 * Chain and return a (possibly asynchronous) call after the outputter,
 * also possibly asynchronous. 
 * @param outputCallResult the result of calling outputter method, will have a `then`
 *        property if it's thenable / asynchronous.
 * @param callback method, possibly asynchronous, which accepts as input the
 *        return value of the outputter method call (`outputCallResult`) 
 */
utils.awaitOutputter = (outputCallResult, afterOutput) => {
  if (outputCallResult.then) {
    return outputCallResult.then((val) => {
      return afterOutput(val) }) 
  } else {
    return afterOutput(outputCallResult)
  }
}

/**
 * Chain and return a (possibly asynchronous) call after the inputter,
 * also possibly asynchronous
 * @param inputCallResult the result of calling the inputter method on some args
 *        will have a `then` property if it's thenable / asynchronous
 * @param callback method, possibly asynchronous, which accepts as input the
 *        return value of the inputter method call (`inputCallResult`)
 */
utils.awaitInputter = (inputCallResult, afterInput) => {
  if (inputCallResult.then) {
    return inputCallResult.then((val) => {
      return afterInput(val) })
  } else {
    return afterInput(inputCallResult)
  }
}

module.exports = utils
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
